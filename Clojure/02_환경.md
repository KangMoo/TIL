## 실행 방법

1. REPL (Read Eval Print Loop) 에서 실행

   - Clojure Command Line Tool을 설치후 `$ clj` 명령 실행

   - ```clojure
     user=> (println "Hello world")
     Hello world
     nil
     ```

2. 파일에 쓴 코드를 Command Line Tools로 실행

   - `.clj` 파일을 만들고 커맨드 라인으로 실행

   - ```clojure
     $ clj hello.clj
     Hello world
     ```

3. **Leiningen 프로젝트 관리툴로 실행**



## Leiningen이란

클로저 프로그램 개발을 위한 프로젝트 관리 도구

- 메이븐 저장소의 클로저/자바 라이브러리를 쉽게 이용할 수 있다
- 프로젝트 생성, 관리, 실행환경 설정 등에 들어가는 노력을 줄일 수 있다.
- 현재 대다수의 클로저 라이브러리와 클로저를 지원하는 웹 서비스 등이 Leiningen을 지원하므로 유리하다.
- 공부하는 입장에서 클로저에 형성된 생태계를 이해하는데 도움이 된다
- REPL 환경에서 개발할 때 편집기와 연동해 개발 환경을 구성할 수 있다

많은 라이브러리를 비롯하여 대부분의 클로저 프로젝트들이 Leiningen을 이용하고 있으므로 특별한 경우가 아니라면 Leiningen 이용은 선택이 아니라 필수라고 봐도 된다. 다만 클로저를 처음 배우는 사람에게는 개발 환경을 설정하는 것이 부담될 수 있으니 기본 문법 등을 익힌 후 라이브러리나 프로젝트 관리가 필요할 때 Leiningen을 이용해도 괜찮다.

### Leiningen 설치

- Leiningen을 사용하려면 인터넷 연결이 되어야 하고, JRE 1.6 이상을 지원하는 자바 가상 머신이 설치되어 있어야 한다.
- 공식사이트(https://leiningen.org/)에 설치 방법이 나와있다.
  - mac 사용자라면 `brew install leiningen` 으로 설치 가능하다

### 새 프로젝트 생성

- `lein new [프로젝트명]`

위의 명령으로 프로젝트 생성이 가능하다. Leiningen 프로젝트 디렉토리와 파일이 생성된다.

```
.
├── doc   .................... 사용설명서, API 문서 등
├── src   .................... 소스코드
│   └── my_project
│       └── core.clj
├── test   ................... 함수별 테스트
│    └── my_project
│        └── core_test.clj
├── resources
├── LICENSE   ................ 라이선스 안내 텍스트 파일
├── README.md   .............. GitHub용 마크다운 문서 파일
└── project.clj   ............ 프로젝트 설정 파일
```

이 외에도 빌드시 target등의 디렉토리가 추가로 생성된다. 디렉토리 구조는 마음대로 변경하면 안된다.프로젝트 생성 후 가장 꼼꼼이 살펴봐야 할 파일은 `project.clj`다. 확장자에서 알 수 있듯 프로젝트 설정 파일은 클로저 문법을 사용한다.

### 프로젝트 설정 / 사용할 라이브러리 추가

새 프로젝트 생성 후 `project.clj` 파일을 편집기로 열면, `project.clj` 파일 내부에는 다음과 같이 `defproject` 매크로를 호출하여 프로젝트를 정의하고 있다.

```clojure
(defproject my-project "0.0.0"
  :description "프로젝트 설명"
  :license "Eclipse Public License 1.0"
  :url "http://..."
  :dependencies [[org.clojure/clojure "1.5.1"]]
  :plugins [[lein-ring "0.4.5"]])
```

`defproject` 매크로의 구성 요소들이 직관적이기 때문에 별다른 설명이 필요하진 않다. 라이브러리 로드 설정을 위한 `:dependencies`에 주목하자

Leiningen은 `project.clj`에 정의된 라이브러리 의존성을 확인해 메이븐 저장소에서 라이브러리를 가져온다. Leiningen이 자동으로 클로저와 라이브러리들을 다운로드하므로 별도로 시스템에 클로저를 설치할 필요는 없다.

프로젝트에 사용할 라이브러리르 지정하려면 `:dependencies`에 해당하는 벡터를 수정하면 된다. 

```clojure
(defproject my-project "0.0.0"
  :description "프로젝트 설명"
  :license "Eclipse Public License 1.0"
  :url "http://..."
  :dependencies [[org.clojure/clojure "1.5.1"]
                 [com.taoensso/nippy "2.1.0"]]
  :plugins [[lein-ring "0.4.5"]])
```

이렇게 지정해두면 다음번에 REPL 환경을 시작하거나 컴파일할 때 Leiningen이 라이브러리 의존성을 확인해 필요한 파일을 자동으로 다운로드 해준다.

> **필요한 라이브러리를 찾으려면**
>
> 원하는 라이브러리의 이름과 버전을 정확히 모른다면 [메이븐 저장소](http://mvnrepository.com/)에서 찾으면 된다. 자바 프로그래머들에게는 너무 당연해서일까? 메이븐에 관해 잘 모르는 사람들도 있을 텐데 이에 관해 설명하는 문서를 본 적이 없어서 약간 의아하다.
> 메이븐 저장소에는 매우 다양한 라이브러리들이 있다. 클로저 라이브러리뿐 아니라 메이븐 저장소에 있는 자바 라이브러리를 지정해서 사용할 수도 있으니 필요한 자바 라이브러리가 있으면 한 번 해보자.



**`defproject`옵션 중 자주 사용되는 옵션**

| 옵션               | 설명                                       |
| ------------------ | ------------------------------------------ |
| :dependencies      | 의존 라이브러리들                          |
| :plugins           | Leiningen 플러그인들                       |
| :repositories      | 라이브러리 저장소 지정                     |
| :main              | 프로그램 시작 함수(-main)가 담긴 패키지    |
| :javac-options     | 컴파일 옵션                                |
| :global-vars       | 클로저 전역 바인딩을 오버라이드하도록 설정 |
| :java-cmd          | 클로저를 실행할 자바 가상 머신의 경로      |
| :jvm-opts          | 자바 가상 머신의 실행 옵션                 |
| :source-paths      | 클로저 소스 파일이 있는 경로들             |
| :java-source-paths | 자바 소스 파일이 있는 경로들               |
| :native-path       | 네이티브 바이너리 코드의 경로              |
| :omit-source       | jar 패키지 생성시 소스코드 포함 여부       |



### REPL 실행

`lein repl` 명령으로 REPL 환경을 시작할 수 있다.

```sh
$ lein repl
nREPL server started on port 46210 on host 127.0.0.1
REPL-y 0.2.1
Clojure 1.5.1
    Docs: (doc function-name-here)
          (find-doc "part-of-name-here")
  Source: (source function-name-here)
 Javadoc: (javadoc java-object-or-class-here)
    Exit: Control+D or (exit) or (quit)

user=>
```

`lein repl`을 통해 실행되는 REPL은 일반적인 클로저 REPL의 기능에 REPL 서버 기능을 더해 vim-fireplace 등 편집기와 연동할 수 있도록 해준다.

### 프로젝트 컴파일

Leiningen의 컴파일 명령을 사용하면 프로젝트에 포함된 클로저 소스코드 `.clj`와 자바 소스코드 `.java`를 JVM 바이트 코드로 컴파일한다. 그 명령은 다음과 같다.

- `$ lein compile`

이 때 주의해야 할 사항이 하나 있는데, 클로저 소스코드를 실행 시점 이전에 컴파일 하도록 하려면 해당 소스코드의 네임스페이스 선언 구문인 `(ns)` 구문을 호출할 때 `(:gen-class)` 구문을 전달해야 한다.

```clojure
(ns clojure.examples.hello
  (:gen-class))
```

그리고 빌드된 클로저 패키지를 바로 실행할 수 있도록 하려면 자바 코드 실행시 main 함수가 정의되어 있어야 하듯이 클로저에서도 시작 함수를 정의해 두어야 한다. 이는 `(:gen-class)` 옵션이 설정된 네임스페이스에서 `-main` 함수를 정의해두면 된다. 자바의 main에 해당하는 함수이므로 명령행 인수를 전달받을 인수가 필요하다

```clojure
(ns clojure.examples.hello
  (:gen-class))

(defn -main
  [greetee]
  (println (str "Hello " greetee "!")))
```



### 프로젝트 빌드

프로젝트를 하나의 jar파일로 만들고 싶다면 다음 명령을 사용한다

* `$ lein uberjar`

그러면 자동으로 소스코드를 컴파일하고 사용된 라이브러리들들 묶어 target 디렉토리에 `프로젝트명-버전.jar`  파일과 `프로젝트명-버전-standalone.jar` 파일을 생성해준다.

jar파일은 자바 실행환경이 설치된 시스템에서 바로 실행할 수 있으므로 바로 배포해도 된다. 그러나 자바에 익숙하지 않은 라이트 유저에게는 네이티브 실행 파일이 더 익숙할 수 있다. 실행 파일을 만들어야 한다면 플랫폼별로 jar를 실행 파일로 래핑해주는 `launch4j`프로그램을 이용할 수 있다.

