## 예외

- 예외는 error의 일종이며 프로그램이 수행 시 또는 컴파일시에 프로그램을 불능상태를 만들어버린다
  - 예외처리는 이러한 예외가 발생할 것을 미리 예측해서 이를 소스상에서 제어하고 처리하는 작업니다.



#### Java의 예외 

```Java
try {
    // 시도할 코드들
} catch (<예외 클래스 1> 변수명) {
    // 예외가 발생할 경우 해당 예외를 처리할 코드
} catch (<예외 클래스 2> 변수명) {
    // 예외가 발생할 경우 해당 예외를 처리할 코드
    // catch는 하나 이상 올 수 있다
} catch (Exception e) { 
    // Exception : 모든 예외의 최상위 부모. 특정하기 어렵거나 모든 예외를 잡고 싶을 때 사용
    // 예외가 발생할 경우 해당 예외를 처리할 코드
} finally {
    // 예외 발생 여부와 상관없이 항상 실행되는 코드
    // finally는 생략 가능하다
}
```

- 단 부모 예외 클래스가 자식 예외 클래스보다 먼저 나오면 안된다



### 예외가 발생했을 때 진행 순서

1. try 블록의 실행이 중단됨
2. catch 블록 중에 발생한 예외를 처리할 수 있는지 찾음
   - 위에서부터 하나씩 평가
3. 예외를 처리할 수 있는 catch 블록이 있다면. 해당 catch 블록안의 코드들이 실행 후 finally 블록 실행. try블록 이후의 코드들이 실행됨
4.  예외를 처할 수 있는 catch 블록이 없다면
   - finally블록을 실행 후 한 단계 높은 try 블록으로 전달



### custom 예외 만들기

- Exception을 상속받는 클래스를 상속받는다 (Exception을 상속받아도 된다)
- 자식 클래스들의 생성자에서 반드시 `super()`를 호출해야 한다
- 호출하지 않을 경우 message, cause가 저장되지 않는다
- message는 getMessage()로 확인 가능하다
- cause는 getCause()로 확인 가능하다

```java
public final class UserNotFoundException extends RuntimeException {
    public UserNotFoundException() {
        super();
    }
    
    public UserNotFoundException(String message) {
        super(message);
    }
    
    public UserNOtFolundException(String message, Throwable cause) {
        super(message, cause);
    }
}
```



### Java의 큰 두가지 예외

**Checked Exception**

- 컴파일러가 예외처리를 제대로 하는지 확인해줌
- 어느 메서드가 어떤 예외를 던지는지 명확히 알 수 있음
- 예외가 발생하는 코드에서 이 둘 중 하나를 안하면 컴파일 오류
  - 발생한 예외를 그 메서드 안에서 처리 (catch 블록)
  - 처리를 안 할 경우 그 사실을 메서드 시그내처 옆에 표기.
    - 메서드 호출자가 다시 이 둘 중 하나를 해야 함

**Unchecked Exception**

- 컴파일러가 따로 검사를 해주지 않음
- 어디서 어떤 예외가 나오는지 한눈에 보이지 않음
- RuntimeException을 상속



![예외](./images/10_1.png)



#### checked 예외의 목적

- 목적 : API 제적자가 이건 클라이언트가 반드시 처리해야할 예외라고 알려주는 용도
- 예외 발생 시 정상상태 회복을 위해서 사용
  - 그렇지만 프로그램을 '회복'하는것이 쉽지 않으며, 모든 경우 안전하게 예외처리를 하는게 거의 불가능
  - 따라서 모든 곳에서 예외를 처리하는 것이 아니라 필요한 곳에서만 예외처리를 하는 것이 필요하고 중요해졌다



### 요즘에 선호하는 예외 처리 방향

- 모든 예외는 **한번에 처리**하자
  - `Exception` 으로 한번에 잡자
- 주로 main()함수에서 한번만
- 따라서 다시 예외를 던지는 일도 훨씬 적어짐 (rethrow)
- 여전히 던질 때는 세세한 예외 형을 던짐 (커스텀 예외 포함)
  - `catch` 를 `Exception` 으로 한번에 할 뿐
- 만약 사람의 감시가 없이 예외가 발생할 수 있는 상황이라면 프로그램 재실행을 시켜주는 다른 프로그램을 이용하자.
  - 근래의 OS는 하드웨어 재부팅이 필요없으니 프로그램 크래시를 크게 두려워하지 않아도 됨
  - 프로그램을 감시하고, 종료될 시 재시작 시켜주는 다른 프로그램 사용
  - 재시작하므로 메모리가 깔끔한 상태로 시작



## 예외는 절대로 제어흐름 용으로 사용하지 말아야 한다

- 예외를 제어흐름 용으로 사용할 시 `goto` 와 개념이 같아진다
  - `goto` 보다 더 안좋은 사용이 된다.
- 프로그램이 복잡해지고, 조금만 건드려도 터지는 경우가 많다.
- 디버깅이 굉장히 어려워진다.
  - 대표적으로, 예외 중단점 사용이 굉장히 어려워짐

