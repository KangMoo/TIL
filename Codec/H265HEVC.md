## H.265/HEVC

- HEVC는 High Efficiency Video Codec의 줄임말로 고효율 비디오 코덱을 일컫는 단어
- H.264보다 높은 압축률과 화질을 가진 코덱으로 H.264의 향상된 버전이라 보면 된다.



### H.265/HEVC의  주요 기술

1. 부호화 블록 구조 (Cioding Block Structure)

   - HEVC의 가장 큰 부호화 구조적 특징으로 H.264/AVC 에서 사용된 고정 크기의 16x16 매크로 블록보다 훨씬 다양한 크기를 가지면서 기능별로 세부화된 CU, PU, TU 단위를 이용한다는 점을 들 수 있다.CU는 부호화가 이루어지는 기본 단위로 64x64 ~ 8x8까지 쿼드트리 구조로 구성된다. 이 때, 쿼드트리로 구성된 CU를 CTU (Coding Tree unit) 라고 한다. PU는 화면 내, 화면 간 예측에 사용되는 단위로 각 PU는 참조 인덱스, 움직임 벡터, 화면 내 예층 모드 등의 정보를 포함한다. 각  PU는 최대 2N˟2N, 2N˟N, N˟2N, N˟N, nL˟2N, nR˟2N, 2N˟nU, 2N˟nD  8가지의 모양이 있다. TU는 변환이 이루어지는 단위로 32˟32에서 4˟4까지 쿼드트리 구조로 구성 된다. 하나의 CU는 여러 개의 TU로 분할 될 수 있으며, PU와 독립적으로 분할될 수 있다.

2. 화면 내 예측 (Intra Prediction)

   - HEVC의 화면 내 예측은 H.264/AVC에서 8개 방향을 포함한 9개 모드를 사용하던 것과 달리 33개 방향에 35개 모드를 사용하여 기존의 화면 내 예측 방법보다 훨씬 더 세분화된 각도의 예측이 가능하도록 설계되었다. 방향성의 증가와 더불어 균등한 영역에서 주관적 화질을 높이기 위한 Intra_Planer 모드와 같은 새로운 모드 추가 이외에도 유효하지 않은 화소를 위해 인접 화소를 이용하는 패딩 (reference sample padding) 기술 및 예측 화소에 대한 저역 필터 (low-pass filter) 기술이 추가되었다. 예측 화소에 대한 전처리 기술은 H.264/AVC 에서는 8x8 블록에서만 적용되었으마, HEVC에서는 모든 크기의 블록에 대해 적용하고 있다. 또한, DC, 수직,수평 모드에 대하여 경계 화소 스무딩 (boundary value smoothing) 기술이 추가되었다.

3. 화면 간 예측 (Inter Prediction)

   - HEVC의 화면 간 예측에는 AMVP (advanced motion vector prediction), 병합 (merge)모드와 DCT-IF(discrete consine transform basesd interpolation filter)가 이용된다. HEVC AMVP는 KTA에 제안된 MVC(motion vector competition)처럼 여러 개의 MVP 후보를 사용하여, 주변 움직임 벡터의 중간 값을 사용하던 H.264/AVC에 비해 MVD(motion vector difference)를 효과적으로 줄일 수 있는 기법이다. 병합모드는 주변 블록의 움직임 정보를 그대로 사용하는 대신, 주변 블록과의 병합 유무에 대한 플래그와 병합 후보의 인덱스를 부호화하는 기술이다. 병합 기술의 추가에 따라, 기존 비디오  코덱에서 사용하던 Skip 모드 대신, CU 단위로 플래그를 직접 명시해주는 방법을 사용하여 Skip 모드 부호화가 수행된다.  AMVP와 병합 모드는 예측 후보의 인덱스를 부호화한다는 공통점이 있으나, AMVP의 경우 2개의 후보, 병합모드는 최대 5개의  후보를 가진다는 점과 후보 선택과정에 있어 차이가 있다. AMVP, 병합 모드와 같은 예측 후보 결정 기술과 더불어 움직임 예측 및 보상의 정밀도를 높이기 위한 보간 필터에도 DCT-IF가 새롭게 채택되었다. H.264/AVC에서는 고정 6-tap 필터를  사용하였으나, HEVC에서는 휘도 성분에서는 8-tap (7-tap) DCT-IF, 색차성분에서는 4-tap DCT-IF를  사용한다. DCT-IF란, DCT 과정에서 분수 화소 성분의 위치 값을 복원하는 계수를 구할 수 있으며, 이 계수 값들을 이용하여 보간을 수행하는 기술이다. H.264/AVC에서 1/4화소를 보간함에 있어 1/2화소를 이용하여 양선형 (bi-linear)  필터를 적용하는 방식과 달리, HEVC에서는 1/4화소에 대한 직접 필터 연산을 수행한다. 또한, 필터 계수의 개수가 증가하여  보다 정확한 보간은 가능해졌으나, 이에 따른 계산 복잡도의 증가는 실시간 부호화에 있어 큰 문제점으로 지적되고 있다.

4. 변환 (Transform) 과 양자화 (Quantization)

   - HEVC는 기존의 비디오 코덱과 달리 변환 과정만을 위한 단위인 TU를 별도로 정의하며, 변환을 위한 커널의 크기는 4˟4, 8˟8,  16˟16, 32˟32로 다양하게 지원한다. TU의 구조는 쿼드트리로 구성되며, PU와는 독립적으로 분할 될 수있으나 TU가 속한 CU의 크기를 초과할 수 없다. HM 2.0까지는 4˟4, 8˟8 변환은 H.264/AVC와 동일한 변환 커널을 사용하였고,  16˟16, 32˟32 변환은 Chen 알고리즘 기반의 DCT를 사용하였다. HM 3.0 이후, 변환과정의 중간 값이 16비트  표현이 가능한 형태의 partial butterfly 형태의 2-D 분할 변환이 제안되어 현재까지 사용되고 있다.

     이외에도 4˟4 화면 내 예측에서는 모드에 따른 방향 의존성을 가지는 DST (discrete sine transform)를 지원하고,  main 프로파일에는 채택되지 않았으나 정방형태의 변환 외에도 NSQT (non square quad-tree transform) 기술도 제안 되었다.

5. 엔트로피 부호화 (Entropy Coding)

   - H.264/AVC 표준에서는 CABAC과 CAVLC의 두 가지 엔트로피 코딩을 사용했지만 H.265/HEVC에서는 CABAC만을 사용한다.  HEVC CABAC은 H.264/AVC CABC의 기본구조를 그대로 채택하였다. 기본구조는 동일한 엔트로피 코딩기술이 사용되지만  HEVC CABAC에서는 심볼을 압축하기 위해 사용되는 문맥 정보를 유도함에 있어, 쿼드트리 구조를 활용하며, 총 문맥 정보의  수는 H.264/AVC 대비 크게 감소되었다. 또한, 간단한 연산만을 요구하는 CABAC의 bypass mode가  H.264/AVC에 비해 폭넓게 사용됨으로써 엔트로피 코딩 부분에서의 throughput을 향상시킨다.

     2차원 변환이 적용된 후 얻어진 변환 계수들을 1차원 형태의 데이터로 변환하기 위해 사용되는 계수 스캐닝 기술 또한 많은 변화가  이루어졌다. JPEG부터 사용되어 왔던 ZIGZAG 스캐닝은 우상향 대각 방향 스캐닝으로 변경되어 구현을 좀더 용이하게 하였고,  화면 내 예측의 경우 가로 방향, 세로 방향 스캐닝을 방향성에 맞게 적응적으로 사용함으로써 압축 효율을 향상시킨다.

6. 루프 필터 (Loop Filter)

   - HEVC의 루프 필터는 기존의 블록킹 열화를 제거하기 위한 디블록킹 필터 뿐 아니라, 양자화에서 오는 압축손실을 보상하기 위한  SAO (sample adaptive offset)와 ALF(adaptive loop filter)가 추가되었다. 디블록킹 필터의 경우 PU, TU 경계에서 발생하는 블록킹 열화를 제거하기 위한 기술로서 H.264/AVC와 유사하지만, 연산 복잡도를 낮추기  위해 필터 과정을 간소화 하였다. 이와 더불어 HEVC에서 채택된 SAO는 부호화과정을 통해 발생하는 원본 영상과 복원 영상간의  왜곡을 보상하기위해 화소단위의 오프셋을 이용하는 기술이다. 디블록킹 필터와 달리, SAO 기술은 원본 영상과 복원 영상간의 오류를 직접 계산하기 때문에 주관적 화질뿐만 아니라 객관적 화질의 향상도 기대할 수 있다. ALF는 VCEG 회의에서 관련 기고서가  제안되었고, KTA 소프트웨어에 채택된 위너(winer) 필터를 기반으로 하는 기술이다. 각 블록에 대한 필터 적용 여부 및 필터 계수를 전송하는 기술로서, HEVC 표준화 초기 단계에서는 HE(high efficiency)모드에서 ALF를 사용하였으나,  지난 7차 제네바 회의에서 프로파일에 대한 논의가 진행되면서 main 프로파일에서 제외되었다.

