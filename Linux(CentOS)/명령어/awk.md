## awk

- 데이터를 조작하고 리포트를 생성하기 위해 사용하는 언어. 리눅스에서 사용하는 awk는 GNU버전의 gawk로 심볼릭 링크되어있다
- 간단한 연산자를 명령라인에서 사용할 수 있으며, 큰 프로그램을 위해 사용될 수 있다. awk는 데이터를 조작할 수 있기 때문에 쉘 스크립트에서 사용되는 필수 툴이며, 작은 데이터베이스를 관리하기 위해서도 필수이다.



### awk 형식

- `awk 'pattern' filename`
- `awk '{action}' filename`
- `awk 'pattern {action}' filename`

### 

### awk 동작원리

1. awk는 파일 또는 파이프를 통해 입력 라인을 얻어와 $0라는 내부 변수에 라인을 입력. 각 라인은 레코드라고 부르고, newline에 의해 구분
2. 라인은 공백을 기준으로 각각의 필드나 단어로 나뉜다. 필드는 $1부터 시작. 많게는 100개 이상의 필드를 저장할 수 있음
3. 내장 변수인 `FS`라고 부르는 필드 분리자가 공백을 할당받는다. 필드가 콜론이나 대시와 같은 문자에 의해 분리되면 새로운 필드 분리자로 FS의 값을 변경할 수 있다
4. awk는 화면에 필드를 출렿갈 때 print함수를 사용한다
5. 콤마븐 출력필드 분리자(OFS)ㅓ와 매핑되어 있으며 공백을 할당받는다

### OFMT변수

- 숫자를 출력할 때 숫자 포맷 제어할 경우 사용. 간단히 `printf`를 사용할 수도 있지만, OFMT를 지정할 수도 있음
- default는 `%.6g`로 소수점 6자리

> ```shell
> $ awk 'BEGIN{OFMT="%.2f"; print 1.23412, 15E-3}'
> > 1.23 0.01
> ```

### print함수

- 포매팅된 깔끔한 출력을 할 경우 사용
- newline을 제공하지 않기 때문에 newline이 요구되면 `\n`을 사용해야함
- c:문자, d:10진수, f:실수, x:16진수
- `-`이 붙으면 좌측에서 시작되고 기본형이면 우측에서 시작

### awk -f옵션

- awk액션과 명령이 파일에 작성되어 있다면 `-f`옵션을 사용
  - `awk -f [awk 명령파일] [awk 명령을 적용할 텍스트 파일]`

### 레코드와 필드

**레코드**

- awk는 입력 데이터를 볼 수 없지만 포맷 또는 구조를 볼 수 있다. 레코드라고 불리는 각 라인은 newline으로 분리
- NR변수 : 각 레코드들의 번호는 awk의 빌트인 변수 NR에 저장된다. 레코드가 저장된 다음 NR의 값은 하나씩 증가한다

**필드**

- 각 레코드는 디폴트르 공백이나 탭으로 분리된 필드라는 워드로 구성된다. NF에 필드의 수를 유지하며 라인당 100개의 필드를 가질 수 있다

**필드분리자**

- 빌트인 변수 `FS`는 입력 필드 분리자의 값을 가지고 있다. default는 공백과 탭. `FS`값을 변경하기 위해선 `-F`를 사용해야 하며 `-F`다음에 오는 문자가 새로운 필드 분리자가 된다.

| 옵션 | 설명                                                         |
| ---- | ------------------------------------------------------------ |
| -f   | awk프로그램 파일을 사용하기 위해 사용한다. (-f 파일명)       |
| -F   | 입력 필드 구분자를 정의하기 위해 사용한다. 기본 필드 구분자는 스페이스이다 (-F :) |
| -v   | 변수를 선언하기 위해 사용한다 (-v 변수명=값)                 |

| 변수 | 설명                                                         |
| ---- | ------------------------------------------------------------ |
| FS   | 입력 필드 구분자 (기본 스페이스)                             |
| RS   | 입력 레코드 구분자 (기본 줄바꿈)                             |
| OFS  | 출력 필드 구분자 (기본 스페이스)                             |
| ORS  | 출력 필드 그룹 구분자 (기본 줄바꿈)                          |
| NR   | 입력된 총 레코드 수 (레코드는 입력 줄로 생각하면 이해하기 쉬움) |
| NF   | 입력된 레코드의 총 필드 수                                   |
| $1   | 첫 번째 필드값                                               |
| $n   | n번째 필드값                                                 |

| 정의  | 설명                                                  |
| ----- | ----------------------------------------------------- |
| BEGIN | 입력 첫 레코드를 읽기 전 실행되어야 하는 내용 정의    |
| BODY  | 패턴에 일치하는 모든 입력 레코드를 action에 의해 처리 |
| END   | awk 프로그램 종료 전 처리되어야 하는 내용 정의        |

